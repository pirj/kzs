
<div class="container">
  <ul class="row top-pannel clearfix">
    <li class="col-md-2">
      <a href="#"><%= link_to "Назад", :back, :class => "btn btn-sm back-btn" %></a>
    </li>
    <li class="col-md-5">
      <% if action?('new') %>
            <h1>
              <% if params[:type] == 'mail' %>
                  Новое письмо
              <% elsif params[:type] == 'writ' %>
                  Новое распоряжение
              <% end %>
            </h1>
      <% end %>
    </li>
    <li class="col-md-3"></li>
    <li class="col-md-4 pull-right">
      <%= form_tag documents_path, method: :get, :remote => true, :id => "text-search" do %>
          <%= render 'shared/user' %>
      <% end %>
    </li>
  </ul>
  <ul class="nav nav-pills">
      <li><%= link_to "Шаблоны", "#", :class => "btn btn-sm btn-default" %></li>
    <li><%= link_to "Черновики", drafts_documents_path, :class => "btn btn-sm btn-default" %> </li>
  </ul>




  <%= form_for(@document, :html => { :class => "form new-doc" }) do |f| %>
	
	<!-- hidden_fields -->
	<% if action?('new') %>
	<%= f.hidden_field :document_type, :value => params[:type] %>
	<% elsif action?('reply') %>
	<%= f.hidden_field :document_type, :value => @original_document.document_type %>
	<% elsif %>
	<%= f.hidden_field :document_type, :value => @document.document_type %>
	<% end %>
	<%= f.hidden_field :document_conversation_id, :value => @document_conversation_id %>
  <!-- end -->



	<%= f.text_field :title, :class => 'form-control', :placeholder => 'Прошу предусмотреть' %>
	
	<% if @document.document_type == 'writ' || action?('new') && params[:type] == 'writ' %> 
	<%= f.text_field(:deadline, :class => 'form-control', :placeholder => 'Дата исполонения') %><br>
	<% end %>
	
	<%= f.collection_select(:organization_ids, Organization.where('id != ?', current_user.organization_id), :id, :title, {:include_blank => false, :selected => @document.organization_id}, {multiple: true, :'data-placeholder' => "Организация-получатель", :class => 'form-control' }) %>
	<%= f.collection_select(:approver_ids, @approvers, :id, :first_name_with_last_name, {:selected => @document.approver_id}, {multiple: true, :'data-placeholder' => "Контрольное-лицо", :class => 'form-control'}) %>
	<%= f.collection_select(:executor_ids, @executors.all, :id, :first_name_with_last_name, {:selected => @document.executor_id}, {multiple: true, :'data-placeholder' => "Исполнитель", :id => "document_executor_ids", :class => 'form-control' }) %>
	<%= f.text_area :text,  :placeholder => 'Текст', :rows => "14", :class => "form-control"  %>
	
	  
	  <% if @document.document_type == 'writ' || params[:type] == 'writ' %>    
      <%= f.fields_for :task_list do |builder| %>
        <%= render 'task_list_fields', f: builder %>
      <% end %>
    <% end %>
	  
    <%= f.fields_for :document_attachments do |builder| %>
      <%= render 'document_attachment_fields', f: builder %>
    <% end %>
    <%= link_to_add_fields "Добавить приложение", f, :document_attachments   %>
      

    <a href="#" class="add_documents">Прикрепить документы</a>
    <div class="list_to_add_documents">
    <%= hidden_field_tag "document[document_ids][]", nil %>
    <% @documents.each do |document| %>
    <label class="checkbox">
    <%= check_box_tag "document[document_ids][]", document.id, @document.document_ids.include?(document.id), id: dom_id(document) %>
    <b><%= document.title %></b> ||
    <%= t(document.document_type) %> ||
    <%= Russian::strftime(document.created_at, "%d %B %Y %H:%M") %>
    </label>
    <% end %>
    </div>
    

	
	
	<%= render 'actions_form', :f => f %>

	<% end %>
</div>
